<template>
  <require from="./processdef-list.css"></require>
  <require from="../user-login/user-login"></require>
  <require from="../process-solution-panel/process-solution-panel"></require>

  <div class="process-def-list">
    <div if.bind="diagrammToImport">
      <div class="modal  fade in show" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Import BPMN Diagram</h5>
            </div>
            <form class="modal-dialog__import-bpmn" submit.delegate = "checkDiagrammName()">
              <p>Import as:</p>
              <input type="text" value.bind="diagrammToImport.name" focus.one-time="true" placeholder="Definition Name">
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal" click.delegate="cancelImport()">Cancel</button>
                <button type="button" class="btn btn-success" click.delegate="checkDiagrammName()">Confirm</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-backdrop fade in"></div>
    </div>
    <div if.bind="diagrammToOverride">
      <div class="modal  fade in show" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Diagramm already existing!</h5>
            </div>
            <div class="modal-body">
              <p>There is already a Diagramm with that name.</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" data-dismiss="modal" click.delegate="cancelOverride(diagrammToOverride)">Cancel</button>
              <button type="button" class="btn btn-success" data-dismiss="modal" click.delegate="changeName(diagrammToOverride)">Change Name</button>
              <button type="button" class="btn btn-warning" click.delegate="overrideDiagramm(diagrammToOverride)">Override</button>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-backdrop fade in"></div>
    </div>
    <div class="menu-bar menu-bar--system-macos">
      <div class="menu-bar__menu menu-bar__menu--left">
        <div class="menu__menu-tabbed-link">
          <a class="menu-tabbed-link menu-bar__menu-left--options" href="#/configuration">
            <i class="fa fa-cog"></i>
          </a>
        </div>
        <div class="menu__menu-tabbed-link">
          <button class="menu-tabbed-link menu-bar__menu-center--action-button" class.bind="solutionExplorerIsShown ? 'solution-explorer__active' : ''" click.delegate="toggleSolutionExplorer()">
            <i class="fa fa-folder"></i>
          </button>
        </div>
        <div class="menu__menu-tabbed-link menu__menu-tabbed-link--active">
          <a class="menu-tabbed-link" href="#">Plan</a>
        </div>
        <div class="menu__menu-tabbed-link">
          <a class="menu-tabbed-link menu-tabbed-link--disabled">Design</a>
        </div>
        <div class="menu__menu-tabbed-link">
          <a class="menu-tabbed-link menu-tabbed-link--disabled">Publish</a>
        </div>

        <div class="btn-group">
          <div class="menu__menu-tabbed-link" data-toggle="dropdown">
            <a class="menu-tabbed-link">Dashboard</a>
          </div>
          <ul class="dropdown-menu menu-bar__dashboard-dropdown">
            <li>
              <a href="#/task">Task List</a>
            </li>
            <li>
              <a href="#/process">Process Instance List</a>
            </li>
          </ul>
        </div>
      </div>

      <div class="menu-bar__menu menu-bar__menu--center"></div>

      <div class="menu-bar__menu menu-bar__menu--right">
        <user-login></user-login>
      </div>
    </div>

    <process-solution-panel show.bind="solutionExplorerIsShown"></process-solution-panel>

    <div class="processdef-list-container">
      <div show.bind="_processes">
        <a class="btn btn-success create-process" click.delegate="createProcess()">
          <i class="fa fa-magic processdef-list__btn-image"></i>Create Process Definition
        </a>
        <a class="btn btn-primary import-bpmn" click.delegate="fileInput.click()">
          <i class="glyphicon glyphicon-import processdef-list__btn-image"></i>Import BPMN
        </a>
        <input type="file" ref="fileInput" accept=".xml,.bpmn" files.bind="selectedFiles" class="hidden">
        <table class="table table-striped table-bordered">
          <tr>
            <th>ProcessDefinitionName</th>
            <th>ProcessDefinitionId</th>
            <th></th>
          </tr>
          <tr repeat.for="process of processes" id="processDef">
            <td>${process.name}</td>
            <td>${process.id}</td>
            <td>
              <button click.delegate="startProcess(process.id)" class="btn btn-success">Start</button>
              <button click.delegate="showDetails(process.id)" class="btn btn-primary" id="processDefDetailsButton">Details</button>
            </td>
          </tr>
        </table>
        <div class="col-md-12 col-xs-12 pagination">
          <aubs-pagination page-size.bind="pageSize" total-items.bind="totalItems" current-page.bind="currentPage"
            boundary-links.bind="true">
          </aubs-pagination>
        </div>
      </div>
      <div show.bind="!_processes" class="container">
        <img src="src/resources/images/gears.svg" class="loading-spinner">
      </div>
    </div>
  </div>
</template>
